name: Explore bunny.net API

# Manual trigger only - run this to explore API behavior
on:
  workflow_dispatch:

jobs:
  explore:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up environment
        run: |
          echo "BUNNY_API_URL=https://api.bunny.net" >> $GITHUB_ENV
          echo "Starting API exploration - BASIC TEST"

      # =================================================================
      # STEP 1: CLEANUP - Clear all zones from account
      # =================================================================
      - name: Step 1 - List existing zones
        run: |
          echo "=========================================="
          echo "STEP 1: List all existing zones"
          echo "=========================================="

          curl -v \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            "$BUNNY_API_URL/dnszone" \
            2>&1 | tee zones-before.log

          echo ""
          echo "Pretty-printed:"
          curl -s \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            "$BUNNY_API_URL/dnszone" \
            | jq '.'

      - name: Step 1 - Extract zone IDs
        run: |
          echo "=========================================="
          echo "STEP 1: Extract zone IDs for deletion"
          echo "=========================================="

          curl -s \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            "$BUNNY_API_URL/dnszone" \
            | jq -r '.Items[]?.Id // empty' > zone-ids.txt

          echo "Found zone IDs:"
          cat zone-ids.txt

          ZONE_COUNT=$(wc -l < zone-ids.txt | tr -d ' ')
          echo "Total zones to delete: $ZONE_COUNT"

      - name: Step 1 - Delete all existing zones
        run: |
          echo "=========================================="
          echo "STEP 1: Delete all existing zones"
          echo "=========================================="

          if [ ! -s zone-ids.txt ]; then
            echo "âœ“ No zones to delete - account is already empty"
            exit 0
          fi

          while read -r zone_id; do
            if [ -n "$zone_id" ]; then
              echo ""
              echo "â†’ Deleting zone ID: $zone_id"

              curl -v -X DELETE \
                -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
                "$BUNNY_API_URL/dnszone/$zone_id" \
                2>&1 | tee "delete-zone-${zone_id}.log"

              echo "âœ“ Deleted zone $zone_id"
              sleep 1
            fi
          done < zone-ids.txt

          echo ""
          echo "âœ“ All zones deleted"

      # =================================================================
      # STEP 2: VERIFY - Account should be empty
      # =================================================================
      - name: Step 2 - Verify account is empty
        run: |
          echo "=========================================="
          echo "STEP 2: Verify account is empty"
          echo "=========================================="

          curl -v \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            "$BUNNY_API_URL/dnszone" \
            2>&1 | tee zones-after-cleanup.log

          echo ""
          echo "Pretty-printed:"
          curl -s \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            "$BUNNY_API_URL/dnszone" \
            | jq '.' | tee zones-empty.json

          ZONE_COUNT=$(jq '.Items | length' zones-empty.json)
          echo ""
          echo "Zone count: $ZONE_COUNT"

          if [ "$ZONE_COUNT" != "0" ]; then
            echo "âœ— ERROR: Account is not empty after cleanup!"
            exit 1
          fi

          echo "âœ“ Account is empty"

      # =================================================================
      # STEP 3: CREATE - Add a fake test zone
      # =================================================================
      - name: Step 3 - Create fake test zone
        run: |
          echo "=========================================="
          echo "STEP 3: Create fake test zone"
          echo "=========================================="

          curl -v -X POST \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{"Domain": "test-basic-explore.xyz"}' \
            "$BUNNY_API_URL/dnszone" \
            2>&1 | tee create-test-zone.log

          echo ""
          echo "Pretty-printed:"
          curl -s -X POST \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{"Domain": "test-basic-explore.xyz"}' \
            "$BUNNY_API_URL/dnszone" \
            | jq '.' | tee test-zone.json

          # Save zone ID for cleanup
          TEST_ZONE_ID=$(jq -r '.Id' test-zone.json)
          echo "TEST_ZONE_ID=$TEST_ZONE_ID" >> $GITHUB_ENV

          echo ""
          echo "âœ“ Created test zone ID: $TEST_ZONE_ID"

      - name: Step 3 - Verify zone was created
        run: |
          echo "=========================================="
          echo "STEP 3: Verify zone was created"
          echo "=========================================="

          echo "Listing all zones to verify creation..."

          curl -v \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            "$BUNNY_API_URL/dnszone" \
            2>&1 | tee zones-after-create.log

          echo ""
          echo "Pretty-printed:"
          curl -s \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            "$BUNNY_API_URL/dnszone" \
            | jq '.' | tee zones-list.json

          ZONE_COUNT=$(jq '.Items | length' zones-list.json)
          echo ""
          echo "Zone count: $ZONE_COUNT"

          if [ "$ZONE_COUNT" != "1" ]; then
            echo "âœ— ERROR: Expected 1 zone, found $ZONE_COUNT"
            exit 1
          fi

          ZONE_DOMAIN=$(jq -r '.Items[0].Domain' zones-list.json)
          echo "Zone domain: $ZONE_DOMAIN"

          if [ "$ZONE_DOMAIN" != "test-basic-explore.xyz" ]; then
            echo "âœ— ERROR: Wrong domain found: $ZONE_DOMAIN"
            exit 1
          fi

          echo "âœ“ Zone created successfully and visible in list"

      # =================================================================
      # STEP 3b: DNS QUERY - Check if amazon.com exists on bunny.net nameservers
      # =================================================================
      - name: Step 3b - Query amazon.com via DNS
        run: |
          echo "=========================================="
          echo "STEP 3b: DNS queries for amazon.com"
          echo "=========================================="
          echo "Question: Is amazon.com actually hosted on bunny.net nameservers?"
          echo ""

          echo "--- Query via Bunny.net nameserver (kiki.bunny.net) ---"
          dig @kiki.bunny.net amazon.com A +short || echo "Query failed"
          echo ""

          echo "--- Query via Bunny.net nameserver (coco.bunny.net) ---"
          dig @coco.bunny.net amazon.com A +short || echo "Query failed"
          echo ""

          echo "--- Query via Cloudflare (1.1.1.1) ---"
          dig @1.1.1.1 amazon.com A +short || echo "Query failed"
          echo ""

          echo "--- Query via Quad9 (9.9.9.9) ---"
          dig @9.9.9.9 amazon.com A +short || echo "Query failed"
          echo ""

          echo "--- Check amazon.com nameservers ---"
          dig amazon.com NS +short || echo "Query failed"

      # =================================================================
      # STEP 3c: EXPLORE - Try to add amazon.com
      # =================================================================
      - name: Step 3c - Try to create amazon.com zone
        run: |
          echo "=========================================="
          echo "STEP 3c: Try to add amazon.com as a zone"
          echo "=========================================="
          echo "Question: Can we add a well-known domain we don't own?"
          echo ""

          curl -v -X POST \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{"Domain": "amazon.com"}' \
            "$BUNNY_API_URL/dnszone" \
            2>&1 | tee create-amazon-zone.log

          echo ""
          echo "Pretty-printed:"
          curl -s -X POST \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{"Domain": "amazon.com"}' \
            "$BUNNY_API_URL/dnszone" \
            | jq '.' | tee amazon-zone.json || echo "Request failed or returned non-JSON"

          # Check if it succeeded
          AMAZON_ZONE_ID=$(jq -r '.Id // empty' amazon-zone.json 2>/dev/null)
          if [ -n "$AMAZON_ZONE_ID" ]; then
            echo ""
            echo "ðŸ¤¯ SURPRISE: We CAN add amazon.com! Zone ID: $AMAZON_ZONE_ID"
            echo "AMAZON_ZONE_ID=$AMAZON_ZONE_ID" >> $GITHUB_ENV
          else
            echo ""
            echo "âŒ As expected: Cannot add amazon.com (we don't own it)"
          fi

      # =================================================================
      # STEP 3d: EXPLORE - Try several large EU companies
      # =================================================================
      - name: Step 3d - Try to create zones for EU companies
        run: |
          echo "=========================================="
          echo "STEP 3d: Try large EU company domains"
          echo "=========================================="
          echo "Question: Are all well-known domains blocked, or just some?"
          echo ""

          # List of large EU companies to test
          DOMAINS=(
            "siemens.com"
            "shell.com"
            "nestle.com"
            "sap.com"
            "lvmh.com"
            "unilever.com"
          )

          for domain in "${DOMAINS[@]}"; do
            echo ""
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo "Testing: $domain"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

            # Make single request, save verbose output and JSON response
            curl -v -X POST \
              -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
              -H "Content-Type: application/json" \
              -d "{\"Domain\": \"$domain\"}" \
              "$BUNNY_API_URL/dnszone" \
              2>&1 | tee "create-${domain}.log"

            echo ""
            echo "Pretty-printed:"
            # Extract just the JSON body from the log (last line)
            RESPONSE=$(tail -1 "create-${domain}.log")
            echo "$RESPONSE" | jq '.' 2>/dev/null || echo "$RESPONSE"

            # Check if it succeeded
            ZONE_ID=$(echo "$RESPONSE" | jq -r '.Id // empty' 2>/dev/null)
            if [ -n "$ZONE_ID" ] && [ "$ZONE_ID" != "null" ]; then
              echo "âœ… SUCCESS: Created zone for $domain (ID: $ZONE_ID)"
              echo "ZONE_${domain/./_}=$ZONE_ID" >> $GITHUB_ENV
            else
              echo "âŒ BLOCKED: Cannot add $domain"
            fi

            # Small delay between requests
            sleep 1
          done

          echo ""
          echo "=========================================="
          echo "Summary: EU Company Domain Tests"
          echo "=========================================="

      # =================================================================
      # STEP 3e: EXPLORE - Domain availability checks
      # =================================================================
      - name: Step 3e - Test domain availability endpoint
        run: |
          echo "=========================================="
          echo "STEP 3e: Domain availability checks"
          echo "=========================================="
          echo "Testing: POST /dnszone/checkavailability"
          echo ""

          # Use EU company domains
          DOMAINS=(
            "siemens.com"
            "shell.com"
            "nestle.com"
            "sap.com"
            "lvmh.com"
            "unilever.com"
          )

          for domain in "${DOMAINS[@]}"; do
            echo ""
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo "Checking availability: $domain"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

            curl -v -X POST \
              -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
              -H "Content-Type: application/json" \
              -d "{\"Name\": \"$domain\"}" \
              "$BUNNY_API_URL/dnszone/checkavailability" \
              2>&1 | tee "availability-${domain}.log"

            echo ""
            echo "Pretty-printed:"
            RESPONSE=$(tail -1 "availability-${domain}.log")
            echo "$RESPONSE" | jq '.' 2>/dev/null || echo "$RESPONSE"

            # Small delay between requests
            sleep 1
          done

          echo ""
          echo "=========================================="
          echo "Summary: Domain Availability Tests"
          echo "=========================================="

      # =================================================================
      # STEP 3f: EXPLORE - DNS scanning
      # =================================================================
      - name: Step 3f - Test DNS scanning endpoint
        run: |
          echo "=========================================="
          echo "STEP 3f: DNS scanning tests"
          echo "=========================================="
          echo "Testing: POST /dnszone/records/scan"
          echo ""

          # Use EU company domains (already created in Step 3d)
          DOMAINS=(
            "siemens.com"
            "shell.com"
            "nestle.com"
          )

          for domain in "${DOMAINS[@]}"; do
            echo ""
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo "Scanning DNS records: $domain"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

            # Trigger scan using Domain parameter
            curl -v -X POST \
              -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
              -H "Content-Type: application/json" \
              -d "{\"Domain\": \"$domain\"}" \
              "$BUNNY_API_URL/dnszone/records/scan" \
              2>&1 | tee "scan-${domain}.log"

            echo ""
            echo "Pretty-printed:"
            RESPONSE=$(tail -1 "scan-${domain}.log")
            echo "$RESPONSE" | jq '.' 2>/dev/null || echo "$RESPONSE"

            # Extract JobId if scan was triggered
            JOB_ID=$(echo "$RESPONSE" | jq -r '.JobId // empty' 2>/dev/null)
            if [ -n "$JOB_ID" ]; then
              echo "âœ… Scan triggered for $domain (JobId: $JOB_ID)"
              echo "JOB_${domain/./_}=$JOB_ID" >> $GITHUB_ENV
            fi

            # Small delay between requests
            sleep 1
          done

          echo ""
          echo "=========================================="
          echo "Summary: DNS Scanning Tests"
          echo "=========================================="

      # =================================================================
      # STEP 3g: EXPLORE - Poll DNS scan results
      # =================================================================
      - name: Step 3g - Poll DNS scan results
        run: |
          echo "=========================================="
          echo "STEP 3g: Poll DNS scan results"
          echo "=========================================="
          echo "Testing: GET /dnszone/{zoneId}/records/scan"
          echo ""

          # First, get zone IDs for the domains we scanned
          echo "Getting zone IDs for scanned domains..."
          curl -s \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            "$BUNNY_API_URL/dnszone" \
            | jq '.Items[] | select(.Domain == "siemens.com" or .Domain == "shell.com" or .Domain == "nestle.com") | {Domain, Id}' \
            > scanned-zones.json

          cat scanned-zones.json

          # Wait a bit for scans to process
          echo ""
          echo "Waiting 5 seconds for scans to process..."
          sleep 5

          # Poll each zone's scan results
          DOMAINS=("siemens.com" "shell.com" "nestle.com")

          for domain in "${DOMAINS[@]}"; do
            echo ""
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo "Checking scan results: $domain"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

            # Get zone ID for this domain
            ZONE_ID=$(jq -r "select(.Domain == \"$domain\") | .Id" scanned-zones.json)

            if [ -z "$ZONE_ID" ] || [ "$ZONE_ID" = "null" ]; then
              echo "âš ï¸  Could not find zone ID for $domain"
              continue
            fi

            echo "Zone ID: $ZONE_ID"
            echo ""

            # Poll scan status (try 3 times with delays)
            for attempt in 1 2 3; do
              echo "Attempt $attempt - Fetching scan results..."

              curl -v -X GET \
                -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
                "$BUNNY_API_URL/dnszone/$ZONE_ID/records/scan" \
                2>&1 | tee "scan-result-${domain}-attempt${attempt}.log"

              echo ""
              echo "âœ… Response saved to scan-result-${domain}-attempt${attempt}.log"
              echo "(Raw output will be available in artifacts for offline analysis)"

              # Small delay before next attempt
              if [ $attempt -lt 3 ]; then
                echo "Waiting 3 seconds before next poll..."
                sleep 3
              fi
            done

            sleep 1
          done

          echo ""
          echo "=========================================="
          echo "Summary: DNS Scan Results"
          echo "=========================================="

      # =================================================================
      # STEP 3h: EXPLORE - Create zones with scan records (test with IsProxied)
      # =================================================================
      - name: Step 3h - Create zones with scan records
        run: |
          echo "=========================================="
          echo "STEP 3h: Create zones with scan records"
          echo "=========================================="
          echo "Testing: POST /dnszone with Records array"
          echo "Testing if IsProxied field is accepted or ignored"
          echo ""

          DOMAINS=("siemens.com" "shell.com" "nestle.com")

          for domain in "${DOMAINS[@]}"; do
            echo ""
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo "Creating zone with records: test-${domain}"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

            # Find the latest scan result file
            SCAN_FILE=$(ls -t scan-result-${domain}-attempt*.log 2>/dev/null | head -1)

            if [ ! -f "$SCAN_FILE" ]; then
              echo "âš ï¸  No scan results found for $domain"
              continue
            fi

            # Extract records from scan results (including IsProxied field - unaltered)
            RECORDS=$(cat "$SCAN_FILE" | strings | grep -o '{"JobId".*' | head -1 | \
              jq -c '.Records[:5]' 2>/dev/null || echo "[]")

            if [ "$RECORDS" = "[]" ] || [ -z "$RECORDS" ]; then
              echo "âš ï¸  Could not extract records from scan results"
              continue
            fi

            echo "Extracted $(echo "$RECORDS" | jq 'length') records from scan"
            echo "Sample record (with IsProxied):"
            echo "$RECORDS" | jq '.[0]' || echo "$RECORDS"
            echo ""

            # Create zone with records (unaltered - includes IsProxied field)
            TEST_DOMAIN="test-${domain}"
            echo "Creating zone: $TEST_DOMAIN with scan records..."

            CREATE_RESPONSE=$(curl -s -X POST \
              -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
              -H "Content-Type: application/json" \
              -d "{\"Domain\": \"$TEST_DOMAIN\", \"Records\": $RECORDS}" \
              "$BUNNY_API_URL/dnszone")

            echo "Response:"
            echo "$CREATE_RESPONSE" | jq '.' 2>/dev/null || echo "$CREATE_RESPONSE"

            # Check if zone was created
            ZONE_ID=$(echo "$CREATE_RESPONSE" | jq -r '.Id // empty' 2>/dev/null)
            if [ -n "$ZONE_ID" ]; then
              echo "âœ… Zone created successfully: $TEST_DOMAIN (ID: $ZONE_ID)"

              # Check how many records were created
              RECORD_COUNT=$(echo "$CREATE_RESPONSE" | jq '.Records | length' 2>/dev/null || echo "0")
              echo "   Records created: $RECORD_COUNT"

              # Save zone ID for cleanup
              echo "ZONE_test_${domain//./_}=$ZONE_ID" >> $GITHUB_ENV
            else
              echo "âŒ Failed to create zone"
              ERROR_MSG=$(echo "$CREATE_RESPONSE" | jq -r '.ErrorKey // .Message // "Unknown error"' 2>/dev/null)
              echo "   Error: $ERROR_MSG"
            fi

            sleep 1
          done

          echo ""
          echo "=========================================="
          echo "Summary: Zone Creation with Scan Records"
          echo "=========================================="

      # =================================================================
      # STEP 3i: EXPLORE - Export zones
      # =================================================================
      - name: Step 3i - Export zones
        run: |
          echo "=========================================="
          echo "STEP 3i: Export zones to BIND format"
          echo "=========================================="
          echo "Testing: GET /dnszone/{id}/export"
          echo ""

          DOMAINS=("siemens.com" "shell.com" "nestle.com")

          for domain in "${DOMAINS[@]}"; do
            echo ""
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo "Exporting zone: test-$domain"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

            # Get zone ID from environment (set in step 3h)
            ZONE_VAR="ZONE_test_${domain//./_}"
            ZONE_ID="${!ZONE_VAR}"

            if [ -z "$ZONE_ID" ] || [ "$ZONE_ID" = "null" ]; then
              echo "âš ï¸  Zone not found for test-$domain"
              continue
            fi

            echo "Zone ID: $ZONE_ID"
            echo "Exporting..."

            curl -v -X GET \
              -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
              "$BUNNY_API_URL/dnszone/$ZONE_ID/export" \
              2>&1 | tee "export-test-${domain}.log"

            # Extract the zone file (non-curl output)
            grep -v "^[\*<>]" "export-${domain}.log" | grep -v "^{" > "export-${domain}.zone" || true

            if [ -s "export-${domain}.zone" ]; then
              echo ""
              echo "âœ… Exported to export-${domain}.zone"
              echo "Preview (first 10 lines):"
              head -10 "export-${domain}.zone"
            else
              echo "âš ï¸  Export file is empty or failed"
            fi

            sleep 1
          done

          echo ""
          echo "=========================================="
          echo "Summary: Zone Exports"
          echo "=========================================="

      # =================================================================
      # STEP 4: CLEANUP - Delete the test zone
      # =================================================================
      - name: Step 4 - Delete test zone
        if: always()
        run: |
          echo "=========================================="
          echo "STEP 4: Cleanup - Delete test zone"
          echo "=========================================="

          # Get all zone IDs
          curl -s \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            "$BUNNY_API_URL/dnszone" \
            | jq -r '.Items[]?.Id // empty' > zone-ids-final.txt

          if [ ! -s zone-ids-final.txt ]; then
            echo "âœ“ No zones to delete"
            exit 0
          fi

          echo "Zones to delete:"
          cat zone-ids-final.txt

          while read -r zone_id; do
            if [ -n "$zone_id" ]; then
              echo ""
              echo "â†’ Deleting zone ID: $zone_id"

              curl -v -X DELETE \
                -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
                "$BUNNY_API_URL/dnszone/$zone_id" \
                2>&1 | tee "cleanup-zone-${zone_id}.log"

              echo "âœ“ Deleted zone $zone_id"
              sleep 1
            fi
          done < zone-ids-final.txt

      - name: Step 4 - Verify final cleanup
        if: always()
        run: |
          echo "=========================================="
          echo "STEP 4: Verify final cleanup"
          echo "=========================================="

          curl -v \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            "$BUNNY_API_URL/dnszone" \
            2>&1 | tee zones-final.log

          echo ""
          echo "Pretty-printed:"
          curl -s \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            "$BUNNY_API_URL/dnszone" \
            | jq '.'

          ZONE_COUNT=$(curl -s \
            -H "AccessKey: ${{ secrets.BUNNY_API_TEST_KEY }}" \
            "$BUNNY_API_URL/dnszone" \
            | jq '.Items | length')

          echo ""
          echo "Final zone count: $ZONE_COUNT"

          if [ "$ZONE_COUNT" != "0" ]; then
            echo "âœ— WARNING: Account is not empty after cleanup!"
            exit 1
          fi

          echo "âœ“ Account is empty - cleanup successful"

      # =================================================================
      # SUMMARY
      # =================================================================
      - name: Summary
        if: always()
        run: |
          echo ""
          echo "=========================================="
          echo "BASIC TEST SUMMARY"
          echo "=========================================="
          echo ""
          echo "âœ“ Step 1: Cleanup - Deleted existing zones"
          echo "âœ“ Step 2: Verify - Confirmed account empty"
          echo "âœ“ Step 3: Create - Added test zone"
          echo "âœ“ Step 4: Cleanup - Removed test zone"
          echo ""
          echo "All basic operations working! âœ…"
          echo ""
          echo "Next: Add more exploration steps as needed"

      - name: Upload logs as artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: basic-test-logs
          path: |
            *.log
            *.json
            *.txt
          retention-days: 30
